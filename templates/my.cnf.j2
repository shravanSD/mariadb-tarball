[client]
port = 3306
socket = {{ mariadb_custom_path }}/socket/mysqld.sock

[mysqld]
user = mysql
socket = {{ mariadb_custom_path }}/socket/mysqld.sock
port = 3306
basedir = /opt/mariadb
datadir = {{ mariadb_custom_path }}/data
tmpdir = {{ mariadb_custom_path }}/tmp
log_error = {{ mariadb_custom_path }}/log/error.log
bind_address = {{ ansible_host }}
innodb_buffer_pool_size = {{(ansible_memtotal_mb*0.60)|round|int}}M
innodb_log_buffer_size = 1024M
innodb_log_file_size = 128M
max_allowed_packet = 128M
innodb_strict_mode = 0
innodb_purge_threads = 1
innodb_stats_persistent = 0
innodb_stats_transient_sample_pages = 128
max_connections = 10000
tmp_table_size = 16M
max_heap_table_size = 16M
sort_buffer_size = 8M
innodb_io_capacity = 5000
group_concat_max_len = 1000000
sql_mode = 'NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'
query_cache_type = 0
query_cache_size = 0
userstat = 1
log_warnings = 1
expire_logs_days = 1
open_files_limit = 65535
log_slow_verbosity = query_plan,innodb
skip-character-set-client-handshake
lower_case_table_names = 1
skip-name-resolve
init_connect = "SET NAMES utf8"
character-set-server = utf8
collation-server = utf8_general_ci
server-id = 201
report_host = mysql
binlog_format = ROW
slow_query_log = 1
slow_query_log_file = {{ mariadb_custom_path }}/log/mysql-slow.log
long_query_time = 1
transaction_isolation = 'READ-COMMITTED'
innodb_buffer_pool_dump_pct = 100
innodb_buffer_pool_dump_at_shutdown = 1
innodb_buffer_pool_load_at_startup = 1
innodb_buffer_pool_instances = 1
innodb_print_all_deadlocks = 1
innodb_flush_method = O_DIRECT
innodb_change_buffering = none
plugin-load-add = sql_errlog.so
sql_error_log_size_limit = 100M